"""Estructura OPTIMIZADA de la sheet Ingresos - Feb 2026."""

INCOME_GROUPS = [
    ("A", "A", ""),
    ("B", "F", "SUELDO"),
    ("G", "H", "AGUINALDO"),
    ("I", "I", "BONOS"),
    ("J", "K", "BENEFICIOS"),
    ("L", "L", "TOTAL"),
    ("M", "P", "INFLACIÓN (CER)"),
    ("Q", "V", "COMPARACION CON ULTIMO AUMENTO ARS"),
    ("W", "AB", "PROYECCION REM"),
    ("AC", "AF", "DÓLAR"),
    ("AG", "AL", "VS ÚLTIMO AUMENTO USD"),
]

INCOME_COLUMNS = [
    ("A", "Fecha", None),
    ("B", "Bruto", None),
    (
        "C",
        "Jubilacion",
        '=IF(OR(ISBLANK(B{r}), B{r}=0), "-", ROUND(B{r}*impuestos!$B$2,0))',
    ),
    ("D", "PAMI", '=IF(OR(ISBLANK(B{r}), B{r}=0), "-", ROUND(B{r}*impuestos!$B$3,0))'),
    (
        "E",
        "Obra Social",
        '=IF(OR(ISBLANK(B{r}), B{r}=0), "-", ROUND(B{r}*impuestos!$B$4,0))',
    ),
    ("F", "Neto", '=IF(OR(ISBLANK(B{r}), B{r}=0), "-", B{r}-C{r}-D{r}-E{r})'),
    ("G", "SAC Bruto", None),
    (
        "H",
        "SAC Neto",
        '=IF(OR(ISBLANK(G{r}), G{r}=0), "-", G{r}-ROUND(G{r}*impuestos!$B$2,0)-ROUND(G{r}*impuestos!$B$3,0)-ROUND(G{r}*impuestos!$B$4,0))',
    ),
    ("I", "Bono Neto", None),
    ("J", "Comida", None),
    ("K", "Otros Beneficios", None),
    (
        "L",
        "Total Neto",
        '=IF(OR(ISBLANK(F{r}), F{r}="-"), "-", IFERROR(IF(SUM(F{r}:K{r})=0, "-", SUM(F{r}:K{r})), "-"))',
    ),
    (
        "M",
        "Δ% CER MoM",
        '=IF(OR(ISBLANK(B{r}), B{r}=0), "-", IFERROR((VLOOKUP(A{r}, historic_data!$A$4:$B, 2, TRUE) / VLOOKUP(A{r-1}, historic_data!$A$4:$B, 2, TRUE)) - 1, "-"))',
    ),
    (
        "N",
        "Δ Bruto MoM",
        '=IF(OR(ISBLANK(B{r}), B{r}=0, ISBLANK(B{r-1})), "-", IFERROR(B{r}/B{r-1}-1,"-"))',
    ),
    (
        "O",
        "Δ Neto MoM",
        '=IF(OR(ISBLANK(B{r}), B{r}=0, ISBLANK(B{r-1})), "-", IFERROR(F{r}/F{r-1}-1,"-"))',
    ),
    (
        "P",
        "Poder Adquisitivo MoM",
        '=IF(OR(M{r}="-", O{r}="-"), "-", IFERROR((1+O{r})/(1+M{r})-1,"-"))',
    ),
    (
        "Q",
        "Bruto Base",
        '=IF(OR(ISBLANK(B{r}), B{r}=0), "-", IF(OR(ROW(B{r})=3, B{r}<>B{r-1}), B{r}, Q{r-1}))',
    ),
    (
        "R",
        "Neto Base",
        '=IF(OR(ISBLANK(B{r}), B{r}=0), "-", IF(OR(ROW(B{r})=3, B{r}<>B{r-1}), F{r}, R{r-1}))',
    ),
    (
        "S",
        "CER Base",
        '=IF(OR(ISBLANK(B{r}), B{r}=0), "-", IF(OR(ROW(B{r})=3, B{r}<>B{r-1}), VLOOKUP(A{r}, historic_data!$A$4:$B, 2, TRUE), S{r-1}))',
    ),
    (
        "T",
        "Paridad CER (Bruto)",
        '=IF(OR(ISBLANK(B{r}), B{r}=0, S{r}="-"), "-", IFERROR(Q{r} * (VLOOKUP(A{r}, historic_data!$A$4:$B, 2, TRUE)/S{r}), "-"))',
    ),
    (
        "U",
        "Paridad CER (Neto)",
        '=IF(OR(ISBLANK(B{r}), B{r}=0, S{r}="-"), "-", IFERROR(R{r} * (VLOOKUP(A{r}, historic_data!$A$4:$B, 2, TRUE)/S{r}), "-"))',
    ),
    (
        "V",
        "Poder Adq. vs Aumento",
        '=IF(OR(ISBLANK(B{r}), B{r}=0, S{r}="-"), "-", IFERROR((F{r}/R{r}) / (VLOOKUP(A{r}, historic_data!$A$4:$B, 2, TRUE)/S{r}) - 1, "-"))',
    ),
    (
        "W",
        "REM 3m (%)",
        '=IF(OR(ISBLANK(B{r}), B{r}=0), "-", (1+IFERROR(VLOOKUP($A{r}, REM!$A$4:$I, 3, FALSE), 0))*(1+IFERROR(VLOOKUP($A{r}, REM!$A$4:$I, 4, FALSE), 0))*(1+IFERROR(VLOOKUP($A{r}, REM!$A$4:$I, 5, FALSE), 0))-1)',
    ),
    ("X", "Objetivo 3m Bruto", '=IF(W{r}="-", "-", IFERROR(B{r} * (1+W{r}), "-"))'),
    ("Y", "Objetivo 3m Neto", '=IF(W{r}="-", "-", IFERROR(F{r} * (1+W{r}), "-"))'),
    (
        "Z",
        "REM 6m (%)",
        '=IF(OR(ISBLANK(B{r}), B{r}=0), "-", (1+W{r})*(1+IFERROR(VLOOKUP($A{r}, REM!$A$4:$I, 6, FALSE), 0))*(1+IFERROR(VLOOKUP($A{r}, REM!$A$4:$I, 7, FALSE), 0))*(1+IFERROR(VLOOKUP($A{r}, REM!$A$4:$I, 8, FALSE), 0))-1)',
    ),
    ("AA", "Objetivo 6m Bruto", '=IF(Z{r}="-", "-", IFERROR(B{r} * (1+Z{r}), "-"))'),
    ("AB", "Objetivo 6m Neto", '=IF(Z{r}="-", "-", IFERROR(F{r} * (1+Z{r}), "-"))'),
    (
        "AC",
        "CCL",
        '=IF(OR(ISBLANK(B{r}), B{r}=0), "-", IFERROR(INDEX(FILTER(historic_data!$C$4:$C, historic_data!$C$4:$C <> ""), MATCH(A{r}, FILTER(historic_data!$A$4:$A, historic_data!$C$4:$C <> ""), 1)), "-"))',
    ),
    (
        "AD",
        "Δ % CCL MoM",
        '=IF(OR(AC{r}="-", AC{r-1}="-"), "-", IFERROR((AC{r}-AC{r-1})/AC{r-1}, "-"))',
    ),
    ("AE", "Sueldo USD Bruto", '=IF(OR(B{r}=0, AC{r}="-"), "-", IFERROR(B{r}/AC{r},"-"))'),
    ("AF", "Sueldo USD Neto", '=IF(OR(F{r}="-", AC{r}="-"), "-", IFERROR(F{r}/AC{r},"-"))'),
    (
        "AG",
        "CCL Base",
        '=IF(OR(ISBLANK(B{r}), B{r}=0), "-", IF(OR(ROW(B{r})=3, B{r}<>B{r-1}), AC{r}, AG{r-1}))',
    ),
    (
        "AH",
        "Sueldo USD Bruto Base",
        '=IF(OR(ISBLANK(B{r}), B{r}=0), "-", IF(OR(ROW(B{r})=3, B{r}<>B{r-1}), AE{r}, AH{r-1}))',
    ),
    (
        "AI",
        "Sueldo USD Neto Base",
        '=IF(OR(ISBLANK(B{r}), B{r}=0), "-", IF(OR(ROW(B{r})=3, B{r}<>B{r-1}), AF{r}, AI{r-1}))',
    ),
    (
        "AJ",
        "Paridad USD (Bruto)",
        '=IF(OR(Q{r}="-", AC{r}="-", AG{r}="-"), "-", IFERROR(Q{r} * (AC{r}/AG{r}), "-"))',
    ),
    (
        "AK",
        "Paridad USD (Neto)",
        '=IF(OR(R{r}="-", AC{r}="-", AG{r}="-"), "-", IFERROR(R{r} * (AC{r}/AG{r}), "-"))',
    ),
    (
        "AL",
        "Atraso USD",
        '=IF(OR(AF{r}="-", AI{r}="-"), "-", IFERROR((AF{r}/AI{r})-1, "-"))',
    ),
]

COLUMN_FORMATS = {
    "A": {"type": "DATE", "pattern": "dd/mm/yyyy"},
    "B": {"type": "CURRENCY", "pattern": "$#,##0"},
    "C": {"type": "CURRENCY", "pattern": "$#,##0"},
    "D": {"type": "CURRENCY", "pattern": "$#,##0"},
    "E": {"type": "CURRENCY", "pattern": "$#,##0"},
    "F": {"type": "CURRENCY", "pattern": "$#,##0"},
    "G": {"type": "CURRENCY", "pattern": "$#,##0"},
    "H": {"type": "CURRENCY", "pattern": "$#,##0"},
    "I": {"type": "CURRENCY", "pattern": "$#,##0"},
    "J": {"type": "CURRENCY", "pattern": "$#,##0"},
    "K": {"type": "CURRENCY", "pattern": "$#,##0"},
    "L": {"type": "CURRENCY", "pattern": "$#,##0"},
    "M": {"type": "PERCENT", "pattern": "0.00%"},
    "N": {"type": "PERCENT", "pattern": "0.00%"},
    "O": {"type": "PERCENT", "pattern": "0.00%"},
    "P": {"type": "PERCENT", "pattern": "0.00%"},
    "Q": {"type": "NUMBER", "pattern": "#,##0"},
    "R": {"type": "NUMBER", "pattern": "#,##0"},
    "S": {"type": "NUMBER", "pattern": "0.0000"},
    "T": {"type": "CURRENCY", "pattern": "$#,##0"},
    "U": {"type": "CURRENCY", "pattern": "$#,##0"},
    "V": {"type": "PERCENT", "pattern": "0.00%"},
    "W": {"type": "PERCENT", "pattern": "0.00%"},
    "X": {"type": "CURRENCY", "pattern": "$#,##0"},
    "Y": {"type": "CURRENCY", "pattern": "$#,##0"},
    "Z": {"type": "PERCENT", "pattern": "0.00%"},
    "AA": {"type": "CURRENCY", "pattern": "$#,##0"},
    "AB": {"type": "CURRENCY", "pattern": "$#,##0"},
    "AC": {"type": "CURRENCY", "pattern": "$#,##0.00"},
    "AD": {"type": "PERCENT", "pattern": "0.00%"},
    "AE": {"type": "NUMBER", "pattern": "#,##0.00"},
    "AF": {"type": "NUMBER", "pattern": "#,##0.00"},
    "AG": {"type": "CURRENCY", "pattern": "$#,##0.00"},
    "AH": {"type": "NUMBER", "pattern": "#,##0.00"},
    "AI": {"type": "NUMBER", "pattern": "#,##0.00"},
    "AJ": {"type": "CURRENCY", "pattern": "$#,##0"},
    "AK": {"type": "CURRENCY", "pattern": "$#,##0"},
    "AL": {"type": "PERCENT", "pattern": "0.00%"},
}

COLUMN_DESCRIPTIONS = {
    "A": "Fecha del registro mensual",
    "B": "Sueldo bruto mensual (input manual)",
    "C": "Descuento jubilación (11% del bruto)",
    "D": "Descuento PAMI (3% del bruto)",
    "E": "Descuento obra social (3% del bruto)",
    "F": "Sueldo neto (bruto - descuentos)",
    "G": "Aguinaldo bruto (input manual)",
    "H": "Aguinaldo neto (SAC - descuentos)",
    "I": "Bonos extraordinarios netos (input manual)",
    "J": "Beneficio de comida mensual (input manual)",
    "K": "Otros beneficios (input manual)",
    "L": "Total neto mensual (suma de todo)",
    "M": "Inflación del mes (CER)",
    "N": "Variación nominal de sueldo bruto",
    "O": "Variación nominal de sueldo neto",
    "P": "Poder adquisitivo ganado/perdido en el mes",
    "Q": "Bruto al momento del último aumento",
    "R": "Neto al momento del último aumento",
    "S": "Valor CER al momento del último aumento",
    "T": "Sueldo bruto para mantener paridad CER",
    "U": "Sueldo neto para mantener paridad CER",
    "V": "Poder adquisitivo acumulado vs último aumento",
    "W": "Inflación proyectada REM 3m",
    "X": "Sueldo bruto objetivo para dentro de 3 meses",
    "Y": "Sueldo neto objetivo para dentro de 3 meses",
    "Z": "Inflación proyectada REM 6m",
    "AA": "Sueldo bruto objetivo para dentro de 6 meses",
    "AB": "Sueldo neto objetivo para dentro de 6 meses",
    "AC": "Dólar CCL cierre de mes",
    "AD": "Variación % CCL MoM",
    "AE": "Sueldo Bruto en USD CCL",
    "AF": "Sueldo Neto en USD CCL",
    "AG": "CCL al momento del último aumento",
    "AH": "Sueldo Bruto USD al momento del último aumento",
    "AI": "Sueldo Neto USD al momento del último aumento",
    "AJ": "Sueldo en ARS para recuperar Bruto USD del aumento",
    "AK": "Sueldo en ARS para recuperar Neto USD del aumento",
    "AL": "Atraso real en USD vs último aumento",
}

IMPUESTOS_ROWS = [
    ("Jubilacion", 0.11, "Ley 24241"),
    ("PAMI", 0.03, "Ley 19032"),
    ("Obra Social", 0.03, "Ley 23660"),
    ("Otro", 0.00, "—"),
]

HISTORIC_VARIABLES = [
    (None, "Fecha", None),
    (30, "CER", "CER"),
    ("IOL/dolarapi", "CCL", "CCL"),
]
